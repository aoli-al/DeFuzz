/*
 * This file was generated by the Gradle 'init' task.
 */

plugins {
    id 'al.aoli.defuzz.kotlin-application-conventions'
    id "io.github.tomtzook.gradle-cmake" version "1.2.2"
}

dependencies {
    implementation 'org.apache.commons:commons-text'
    implementation("com.github.ajalt.clikt:clikt:3.5.1")
    implementation group: 'edu.berkeley.cs.jqf', name: 'jqf-fuzz', version: '2.0-SNAPSHOT'
    implementation group: 'org.junit.platform', name: 'junit-platform-runner', version: '1.9.2'
    implementation group: 'com.pholser', name: 'junit-quickcheck-core', version: '1.0'
    implementation "org.eclipse.collections:eclipse-collections:11.1.0"
    implementation "org.hamcrest:hamcrest-library:2.2"
    implementation group: 'io.github.microutils', name: 'kotlin-logging-jvm', version: '3.0.2'
    implementation group: 'org.slf4j', name: 'slf4j-simple', version: '2.0.6'

    implementation group: 'edu.berkeley.cs.jqf', name: 'jqf-examples', version: '2.0-SNAPSHOT'
}



task fuzzBcel(type: JavaExec) {
    var nat= project(":native")
    classpath "${buildDir}/libs/${project.name}.jar"
    mainClass = "al.aoli.defuzz.fuzzer.cli.MainKt"
    jvmArgs "-agentpath:${nat.buildDir}/cmake/agent/${machines.host.getName()}/cpp/lib${nat.name}.dylib"
    args "edu.berkeley.cs.jqf.examples.bcel.ParserTest", "testWithGenerator", "fuzzresult"
    standardOutput = new ByteArrayOutputStream()
    dependsOn jar
}

jar {
    duplicatesStrategy = DuplicatesStrategy.EXCLUDE

    from {
        configurations.runtimeClasspath.collect { it.isDirectory() ? it : zipTree(it) }
    } {
        exclude 'META-INF/MANIFEST.MF'
        exclude 'META-INF/*.SF'
        exclude 'META-INF/*.DSA'
        exclude 'META-INF/*.RSA'
    }

}
